# 模型变更说明

## 概述

本次更新对库存管理系统的数据模型进行了简化，移除了不必要的字段和复杂的业务逻辑，使系统更加简洁和易于维护。

## 变更详情

### 1. Device 模型简化

#### 主键类型变更：
- `id` 字段从 UUID 字符串改为自增整数类型
- 提高了数据库性能，简化了ID生成逻辑

#### 移除的字段：
- `type` - 设备类型
- `model` - 设备型号  
- `brand` - 设备品牌
- `condition` - 设备状况
- `purchase_date` - 购买日期
- `purchase_price` - 购买价格
- `current_value` - 当前价值
- `daily_rate` - 日租金
- `weekly_rate` - 周租金
- `monthly_rate` - 月租金
- `description` - 设备描述
- `specifications` - 技术规格
- `notes` - 备注信息

#### 保留的字段：
- `id` - 主键（自增整数）
- `name` - 设备名称
- `serial_number` - 设备序列号
- `status` - 设备状态
- `location` - 设备位置
- `created_at` - 创建时间
- `updated_at` - 更新时间

#### 移除的方法：
- `calculate_rental_cost()` - 计算租赁费用
- `get_device_types()` - 获取设备类型
- `get_device_count_by_type()` - 按类型统计设备数量

### 2. Rental 模型简化

#### 移除的字段：
- `customer_email` - 客户邮箱
- `customer_company` - 客户公司
- `purpose` - 使用目的
- `daily_rate` - 日租金
- `total_cost` - 总费用
- `deposit` - 押金
- `created_by` - 创建人
- `approved_by` - 审批人
- `approved_at` - 审批时间
- `notes` - 备注
- `return_notes` - 归还备注

#### 保留的字段：
- `id` - 主键
- `device_id` - 设备ID
- `start_date` - 开始日期
- `end_date` - 结束日期
- `customer_name` - 客户姓名
- `customer_phone` - 客户电话
- `status` - 租赁状态
- `created_at` - 创建时间
- `updated_at` - 更新时间

#### 简化的方法：
- `approve()` - 不再需要指定审批人
- `complete()` - 不再需要归还备注
- `cancel()` - 不再需要取消备注
- `extend()` - 不再需要延期备注

### 3. User 模型删除

完全删除了 User 模型，包括：
- 用户认证和授权
- 用户管理功能
- 创建人和审批人字段

### 4. AuditLog 模型简化

#### 移除的字段：
- `user_id` - 操作用户ID

#### 移除的方法：
- `get_user_actions()` - 获取用户操作记录
- 用户统计相关功能

## 租赁状态说明

### 状态定义：
1. **`pending`** - 待审批：租赁申请已提交，等待审批
2. **`active`** - 租赁中：设备正在被租赁使用
3. **`completed`** - 已完成：租赁正常完成，设备已归还
4. **`cancelled`** - 已取消：租赁被取消
5. **`overdue`** - 逾期：超过约定归还日期

### 状态流转：
```
pending → active → completed
   ↓         ↓        ↑
cancelled  overdue ───┘
```

## 影响分析

### 正面影响：
1. **简化维护**：减少了数据库字段，降低了维护复杂度
2. **提高性能**：减少了数据存储和查询开销
3. **简化业务逻辑**：移除了复杂的费用计算和审批流程
4. **易于扩展**：简化的模型更容易进行后续功能扩展

### 需要注意的地方：
1. **历史数据**：如果数据库中已有数据，需要先备份
2. **API接口**：需要更新相关的API接口和前端页面
3. **业务逻辑**：需要调整相关的业务逻辑代码

## 迁移步骤

1. **备份数据**：在迁移前备份现有数据库
2. **运行迁移脚本**：执行 `001_simplify_models.py` 迁移脚本
3. **更新代码**：确保所有代码都使用新的模型结构
4. **测试验证**：验证系统功能是否正常

## 后续建议

1. **监控系统**：密切关注系统运行状态
2. **用户反馈**：收集用户对新系统的反馈
3. **性能优化**：根据实际使用情况进一步优化
4. **功能扩展**：在简化基础上逐步添加必要功能
