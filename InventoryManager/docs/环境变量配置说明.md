# 环境变量配置说明

## 概述

库存管理系统使用环境变量来管理不同环境的配置。系统提供了多个配置文件模板，可以根据实际部署环境选择合适的配置。

## 配置文件说明

### 1. `env.example` - 环境变量示例文件
- 包含所有可能需要的配置项
- 提供了详细的注释说明
- 适合作为配置参考

### 2. `env.local` - 本地开发环境配置
- 适用于本地开发环境
- 启用了调试模式和详细日志
- 使用本地数据库和缓存服务

### 3. `env.production` - 生产环境配置
- 适用于生产环境部署
- 启用了安全设置和性能优化
- 禁用了调试功能

### 4. `env.docker` - Docker环境配置
- 适用于Docker容器部署
- 配置了容器间的服务发现
- 优化了容器健康检查

## 使用方法

### 方法1：复制配置文件（推荐）

```bash
# 复制对应的配置文件为 .env
cp env.local .env          # 本地开发
cp env.production .env     # 生产环境
cp env.docker .env         # Docker环境

# 然后编辑 .env 文件，根据实际情况修改配置值
nano .env
```

### 方法2：手动创建 .env 文件

```bash
# 创建 .env 文件
touch .env

# 编辑文件，添加需要的环境变量
nano .env
```

### 方法3：在启动时指定环境变量

```bash
# 直接在命令行中设置环境变量
export FLASK_ENV=development
export DATABASE_URL=mysql+pymysql://user:pass@localhost/db
export SECRET_KEY=your-secret-key

# 然后启动应用
python app.py
```

## 核心配置项说明

### 应用基础配置

| 配置项 | 说明 | 示例值 |
|--------|------|--------|
| `FLASK_ENV` | Flask运行环境 | `development`, `production` |
| `FLASK_APP` | Flask应用入口文件 | `app.py` |
| `SECRET_KEY` | 应用密钥（必须修改） | 随机字符串 |
| `API_KEY` | API访问密钥 | 随机字符串 |

### 数据库配置

| 配置项 | 说明 | 示例值 |
|--------|------|--------|
| `DATABASE_URL` | 数据库连接字符串 | `mysql+pymysql://user:pass@host:port/db` |
| `DB_POOL_SIZE` | 数据库连接池大小 | `10` |
| `DB_POOL_RECYCLE` | 连接回收时间（秒） | `3600` |

### Redis配置

| 配置项 | 说明 | 示例值 |
|--------|------|--------|
| `REDIS_URL` | Redis连接字符串 | `redis://localhost:6379/0` |
| `CACHE_TYPE` | 缓存类型 | `simple`, `redis` |
| `CACHE_DEFAULT_TIMEOUT` | 缓存超时时间（秒） | `300` |

### 安全配置

| 配置项 | 说明 | 示例值 |
|--------|------|--------|
| `SESSION_COOKIE_SECURE` | 是否只通过HTTPS发送Cookie | `true`/`false` |
| `SESSION_COOKIE_HTTPONLY` | 是否禁止JavaScript访问Cookie | `true` |
| `CORS_ORIGINS` | 允许的跨域来源 | `*` 或具体域名 |

## 环境特定配置

### 本地开发环境

```bash
# 使用SQLite数据库（简单）
DATABASE_URL=sqlite:///inventory_management.db

# 启用调试模式
DEBUG=true
LOG_LEVEL=DEBUG

# 禁用安全限制（仅开发环境）
SESSION_COOKIE_SECURE=false
CORS_ORIGINS=*
```

### 生产环境

```bash
# 使用生产数据库
DATABASE_URL=mysql+pymysql://prod_user:strong_pass@prod_host:3306/prod_db

# 启用安全设置
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
CORS_ORIGINS=https://yourdomain.com

# 性能优化
DEBUG=false
LOG_LEVEL=WARNING
DB_POOL_SIZE=20
```

### Docker环境

```bash
# 使用Docker服务名
DATABASE_URL=mysql+pymysql://inventory_user:inventory_pass@mysql:3306/inventory_management
REDIS_URL=redis://redis:6379/0

# 容器健康检查
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_TIMEOUT=30
```

## 安全注意事项

### 1. 密钥管理
- **永远不要**将真实的密钥提交到版本控制系统
- 生产环境使用强密码和随机密钥
- 定期轮换密钥

### 2. 数据库安全
- 使用专用数据库用户，避免使用root
- 限制数据库访问权限
- 启用数据库连接加密

### 3. 网络安全
- 生产环境使用HTTPS
- 限制跨域访问来源
- 配置防火墙规则

## 常见问题

### Q1: 如何生成安全的SECRET_KEY？
```python
import secrets
print(secrets.token_hex(32))
```

### Q2: 数据库连接失败怎么办？
- 检查数据库服务是否运行
- 验证连接字符串格式
- 确认网络连接和防火墙设置

### Q3: 如何在不同环境间切换配置？
```bash
# 创建环境特定的配置文件
cp env.local .env.local
cp env.production .env.production

# 使用source命令加载配置
source .env.local      # 加载本地配置
source .env.production # 加载生产配置
```

### Q4: 环境变量没有生效怎么办？
- 确认.env文件在正确位置
- 检查环境变量名称是否正确
- 重启应用程序

## 配置验证

### 1. 检查配置加载
```python
import os
print(f"FLASK_ENV: {os.environ.get('FLASK_ENV')}")
print(f"DATABASE_URL: {os.environ.get('DATABASE_URL')}")
```

### 2. 测试数据库连接
```python
from app import db
try:
    db.engine.execute('SELECT 1')
    print("数据库连接成功")
except Exception as e:
    print(f"数据库连接失败: {e}")
```

### 3. 检查Redis连接
```python
import redis
try:
    r = redis.from_url(os.environ.get('REDIS_URL'))
    r.ping()
    print("Redis连接成功")
except Exception as e:
    print(f"Redis连接失败: {e}")
```

## 最佳实践

1. **环境隔离**：为每个环境创建独立的配置文件
2. **版本控制**：将配置文件模板纳入版本控制，但不要包含真实密钥
3. **配置验证**：在应用启动时验证关键配置项
4. **文档维护**：及时更新配置说明文档
5. **备份配置**：定期备份生产环境配置
6. **监控配置**：监控配置变更和应用行为
