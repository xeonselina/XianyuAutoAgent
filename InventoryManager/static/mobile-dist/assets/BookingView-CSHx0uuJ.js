import{d as R,t as q,c as U,r as O,J as Le,K as ve,a as u,w as z,k as $,L as je,M as ge,N as E,O as ze,P as We,Q as oe,R as X,S as Z,n as W,U as Ge,h as Ye,p as he,H as ye,b as ne,V as Ze,f as G,i as pe,l as le,o as re,m as Ee,W as Je,X as j,Y as Qe,Z as $e,_ as _e,e as Xe,$ as et,a0 as tt,a1 as nt,a2 as De,a3 as at,a4 as ot,a5 as lt,a6 as st,a7 as rt,q as it,s as ut,v as Be,x as F,D as we,C as Ce,A as ke,z as ee,a8 as ct,E as ue}from"./index-C8Hbrb_-.js";import{b as J,B as se,a as dt,L as mt,p as ft,P as Ie,g as vt,m as gt,h as ht,c as bt,d as I,N as yt,C as pt,F as _t,s as K,i as Dt,j as Bt,_ as wt}from"./_plugin-vue_export-helper-95OR25_x.js";const[Ne,xe]=U("action-bar"),Fe=Symbol(Ne),Ct={placeholder:Boolean,safeAreaInsetBottom:q};var kt=R({name:Ne,props:Ct,setup(e,{slots:a}){const n=O(),t=Le(n,xe),{linkChildren:l}=ve(Fe);l();const y=()=>{var f;return u("div",{ref:n,class:[xe(),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[(f=a.default)==null?void 0:f.call(a)])};return()=>e.placeholder?t(y):y()}});const xt=z(kt),[Tt,Ot]=U("action-bar-button"),Vt=$({},ze,{type:String,text:String,icon:String,color:String,loading:Boolean,disabled:Boolean});var St=R({name:Tt,props:Vt,setup(e,{slots:a}){const n=je(),{parent:t,index:l}=ge(Fe),y=E(()=>{if(t){const p=t.children[l.value-1];return!(p&&"isButton"in p)}}),f=E(()=>{if(t){const p=t.children[l.value+1];return!(p&&"isButton"in p)}});return J({isButton:!0}),()=>{const{type:p,icon:v,text:B,color:w,loading:_,disabled:V}=e;return u(se,{class:Ot([p,{last:f.value,first:y.value}]),size:"large",type:p,icon:v,color:w,loading:_,disabled:V,onClick:n},{default:()=>[a.default?a.default():B]})}}});const Te=z(St),[Mt,A,Oe]=U("picker"),He=e=>e.find(a=>!a.disabled)||e[0];function Pt(e,a){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(a.children in n)return"cascade"}return"default"}function ae(e,a){a=oe(a,0,e.length);for(let n=a;n<e.length;n++)if(!e[n].disabled)return n;for(let n=a-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const Ve=(e,a,n)=>a!==void 0&&e.some(t=>t[n.value]===a);function me(e,a,n){const t=e.findIndex(y=>y[n.value]===a),l=ae(e,t);return e[l]}function Yt(e,a,n){const t=[];let l={[a.children]:e},y=0;for(;l&&l[a.children];){const f=l[a.children],p=n.value[y];if(l=We(p)?me(f,p,a):void 0,!l&&f.length){const v=He(f)[a.value];l=me(f,v,a)}y++,t.push(f)}return t}function Et(e){const{transform:a}=window.getComputedStyle(e),n=a.slice(7,a.length-1).split(", ")[5];return Number(n)}function $t(e){return $({text:"text",value:"value",children:"children"},e)}const Se=200,Me=300,It=15,[Ae,ce]=U("picker-column"),Re=Symbol(Ae);var Nt=R({name:Ae,props:{value:W,fields:X(Object),options:Z(),readonly:Boolean,allowHtml:Boolean,optionHeight:X(Number),swipeDuration:X(W),visibleOptionNum:X(W)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:n}){let t,l,y,f,p;const v=O(),B=O(),w=O(0),_=O(0),V=dt(),S=()=>e.options.length,P=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,M=m=>{let b=ae(e.options,m);const s=-b*e.optionHeight,d=()=>{b>S()-1&&(b=ae(e.options,m));const k=e.options[b][e.fields.value];k!==e.value&&a("change",k)};t&&s!==w.value?p=d:d(),w.value=s},c=()=>e.readonly||!e.options.length,r=m=>{t||c()||(p=null,_.value=Se,M(m),a("clickOption",e.options[m]))},g=m=>oe(Math.round(-m/e.optionHeight),0,S()-1),C=E(()=>g(w.value)),x=(m,b)=>{const s=Math.abs(m/b);m=w.value+s/.003*(m<0?-1:1);const d=g(m);_.value=+e.swipeDuration,M(d)},i=()=>{t=!1,_.value=0,p&&(p(),p=null)},T=m=>{if(!c()){if(V.start(m),t){const b=Et(B.value);w.value=Math.min(0,b-P())}_.value=0,l=w.value,y=Date.now(),f=l,p=null}},Y=m=>{if(c())return;V.move(m),V.isVertical()&&(t=!0,he(m,!0));const b=oe(l+V.deltaY.value,-(S()*e.optionHeight),e.optionHeight),s=g(b);s!==C.value&&a("scrollInto",e.options[s]),w.value=b;const d=Date.now();d-y>Me&&(y=d,f=b)},h=()=>{if(c())return;const m=w.value-f,b=Date.now()-y;if(b<Me&&Math.abs(m)>It){x(m,b);return}const d=g(w.value);_.value=Se,M(d),setTimeout(()=>{t=!1},0)},o=()=>{const m={height:`${e.optionHeight}px`};return e.options.map((b,s)=>{const d=b[e.fields.text],{disabled:k}=b,L=b[e.fields.value],H={role:"button",style:m,tabindex:k?-1:0,class:[ce("item",{disabled:k,selected:L===e.value}),b.className],onClick:()=>r(s)},Q={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:d};return u("li",H,[n.option?n.option(b,s):u("div",Q,null)])})};return ge(Re),J({stopMomentum:i}),Ge(()=>{const m=t?Math.floor(-w.value/e.optionHeight):e.options.findIndex(d=>d[e.fields.value]===e.value),b=ae(e.options,m),s=-b*e.optionHeight;t&&b<m&&i(),w.value=s}),Ye("touchmove",Y,{target:v}),()=>u("div",{ref:v,class:ce(),onTouchstartPassive:T,onTouchend:h,onTouchcancel:h},[u("ul",{ref:B,style:{transform:`translate3d(0, ${w.value+P()}px, 0)`,transitionDuration:`${_.value}ms`,transitionProperty:_.value?"all":"none"},class:ce("wrapper"),onTransitionend:i},[o()])])}});const[Ft]=U("picker-toolbar"),ie={title:String,cancelButtonText:String,confirmButtonText:String},Ht=["cancel","confirm","title","toolbar"],At=Object.keys(ie);var Rt=R({name:Ft,props:ie,emits:["confirm","cancel"],setup(e,{emit:a,slots:n}){const t=()=>{if(n.title)return n.title();if(e.title)return u("div",{class:[A("title"),"van-ellipsis"]},[e.title])},l=()=>a("cancel"),y=()=>a("confirm"),f=()=>{var v;const B=(v=e.cancelButtonText)!=null?v:Oe("cancel");if(!(!n.cancel&&!B))return u("button",{type:"button",class:[A("cancel"),ye],onClick:l},[n.cancel?n.cancel():B])},p=()=>{var v;const B=(v=e.confirmButtonText)!=null?v:Oe("confirm");if(!(!n.confirm&&!B))return u("button",{type:"button",class:[A("confirm"),ye],onClick:y},[n.confirm?n.confirm():B])};return()=>u("div",{class:A("toolbar")},[n.toolbar?n.toolbar():[f(),t(),p()]])}});const[Ut]=U("picker-group"),Kt=Symbol(Ut);$({tabs:Z(),activeTab:ne(0),nextStepText:String,showToolbar:q},ie);const be=$({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:ne(44),showToolbar:q,swipeDuration:ne(1e3),visibleOptionNum:ne(6)},ie),qt=$({},be,{columns:Z(),modelValue:Z(),toolbarPosition:Ee("top"),columnsFieldNames:Object});var Lt=R({name:Mt,props:qt,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:n}){const t=O(),l=O(e.modelValue.slice(0)),{parent:y}=ge(Kt),{children:f,linkChildren:p}=ve(Re);p();const v=E(()=>$t(e.columnsFieldNames)),B=E(()=>Ze(e.optionHeight)),w=E(()=>Pt(e.columns,v.value)),_=E(()=>{const{columns:s}=e;switch(w.value){case"multiple":return s;case"cascade":return Yt(s,v.value,l);default:return[s]}}),V=E(()=>_.value.some(s=>s.length)),S=E(()=>_.value.map((s,d)=>me(s,l.value[d],v.value))),P=E(()=>_.value.map((s,d)=>s.findIndex(k=>k[v.value.value]===l.value[d]))),M=(s,d)=>{if(l.value[s]!==d){const k=l.value.slice(0);k[s]=d,l.value=k}},c=()=>({selectedValues:l.value.slice(0),selectedOptions:S.value,selectedIndexes:P.value}),r=(s,d)=>{M(d,s),w.value==="cascade"&&l.value.forEach((k,L)=>{const H=_.value[L];Ve(H,k,v.value)||M(L,H.length?H[0][v.value.value]:void 0)}),pe(()=>{a("change",$({columnIndex:d},c()))})},g=(s,d)=>{const k={columnIndex:d,currentOption:s};a("clickOption",$(c(),k)),a("scrollInto",k)},C=()=>{f.forEach(d=>d.stopMomentum());const s=c();return pe(()=>{const d=c();a("confirm",d)}),s},x=()=>a("cancel",c()),i=()=>_.value.map((s,d)=>u(Nt,{value:l.value[d],fields:v.value,options:s,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:B.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:k=>r(k,d),onClickOption:k=>g(k,d),onScrollInto:k=>{a("scrollInto",{currentOption:k,columnIndex:d})}},{option:n.option})),T=s=>{if(V.value){const d={height:`${B.value}px`},k={backgroundSize:`100% ${(s-B.value)/2}px`};return[u("div",{class:A("mask"),style:k},null),u("div",{class:[Je,A("frame")],style:d},null)]}},Y=()=>{const s=B.value*+e.visibleOptionNum,d={height:`${s}px`};return!e.loading&&!V.value&&n.empty?n.empty():u("div",{ref:t,class:A("columns"),style:d},[i(),T(s)])},h=()=>{if(e.showToolbar&&!y)return u(Rt,re(le(e,At),{onConfirm:C,onCancel:x}),le(n,Ht))},o=s=>{s.forEach((d,k)=>{d.length&&!Ve(d,l.value[k],v.value)&&M(k,He(d)[v.value.value])})};G(_,s=>o(s),{immediate:!0});let m;return G(()=>e.modelValue,s=>{!j(s,l.value)&&!j(s,m)&&(l.value=s.slice(0),m=s.slice(0)),e.modelValue.length===0&&o(_.value)},{deep:!0}),G(l,s=>{j(s,e.modelValue)||(m=s.slice(0),a("update:modelValue",m))},{immediate:!0}),Ye("touchmove",he,{target:t}),J({confirm:C,getSelectedOptions:()=>S.value}),()=>{var s,d;return u("div",{class:A()},[e.toolbarPosition==="top"?h():null,e.loading?u(mt,{class:A("loading")},null):null,(s=n["columns-top"])==null?void 0:s.call(n),Y(),(d=n["columns-bottom"])==null?void 0:d.call(n),e.toolbarPosition==="bottom"?h():null])}}});const Ue=z(Lt),[jt,zt]=U("form"),Wt={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:W,labelAlign:String,inputAlign:String,scrollToError:Boolean,scrollToErrorPosition:String,validateFirst:Boolean,submitOnEnter:q,showErrorMessage:q,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var Gt=R({name:jt,props:Wt,emits:["submit","failed"],setup(e,{emit:a,slots:n}){const{children:t,linkChildren:l}=ve(Qe),y=c=>c?t.filter(r=>c.includes(r.name)):t,f=c=>new Promise((r,g)=>{const C=[];y(c).reduce((i,T)=>i.then(()=>{if(!C.length)return T.validate().then(Y=>{Y&&C.push(Y)})}),Promise.resolve()).then(()=>{C.length?g(C):r()})}),p=c=>new Promise((r,g)=>{const C=y(c);Promise.all(C.map(x=>x.validate())).then(x=>{x=x.filter(Boolean),x.length?g(x):r()})}),v=c=>{const r=t.find(g=>g.name===c);return r?new Promise((g,C)=>{r.validate().then(x=>{x?C(x):g()})}):Promise.reject()},B=c=>typeof c=="string"?v(c):e.validateFirst?f(c):p(c),w=c=>{typeof c=="string"&&(c=[c]),y(c).forEach(g=>{g.resetValidation()})},_=()=>t.reduce((c,r)=>(c[r.name]=r.getValidationStatus(),c),{}),V=(c,r)=>{t.some(g=>g.name===c?(g.$el.scrollIntoView(r),!0):!1)},S=()=>t.reduce((c,r)=>(r.name!==void 0&&(c[r.name]=r.formValue.value),c),{}),P=()=>{const c=S();B().then(()=>a("submit",c)).catch(r=>{a("failed",{values:c,errors:r});const{scrollToError:g,scrollToErrorPosition:C}=e;g&&r[0].name&&V(r[0].name,C?{block:C}:void 0)})},M=c=>{he(c),P()};return l({props:e}),J({submit:P,validate:B,getValues:S,scrollToField:V,resetValidation:w,getValidationStatus:_}),()=>{var c;return u("form",{class:zt(),onSubmit:M},[(c=n.default)==null?void 0:c.call(n)])}}});const Zt=z(Gt),Jt=$({},be,{modelValue:Z(),filter:Function,formatter:{type:Function,default:(e,a)=>a}}),Qt=Object.keys(be);function Xt(e,a){if(e<0)return[];const n=Array(e);let t=-1;for(;++t<e;)n[t]=a(t);return n}const en=(e,a)=>32-new Date(e,a-1,32).getDate(),de=(e,a,n,t,l,y)=>{const f=Xt(a-e+1,p=>{const v=$e(e+p);return t(n,{text:v,value:v})});return l?l(n,f,y):f},tn=(e,a)=>e.map((n,t)=>{const l=a[t];if(l.length){const y=+l[0].value,f=+l[l.length-1].value;return $e(oe(+n,y,f))}return n}),Pe=new Date().getFullYear(),[nn]=U("date-picker"),an=$({},Jt,{columnsType:{type:Array,default:()=>["year","month","day"]},minDate:{type:Date,default:()=>new Date(Pe-10,0,1),validator:_e},maxDate:{type:Date,default:()=>new Date(Pe+10,11,31),validator:_e}});var on=R({name:nn,props:an,emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:a,slots:n}){const t=O(e.modelValue),l=O(!1),y=O(),f=E(()=>l.value?e.modelValue:t.value),p=i=>i===e.minDate.getFullYear(),v=i=>i===e.maxDate.getFullYear(),B=i=>i===e.minDate.getMonth()+1,w=i=>i===e.maxDate.getMonth()+1,_=i=>{const{minDate:T,columnsType:Y}=e,h=Y.indexOf(i),o=f.value[h];if(o)return+o;switch(i){case"year":return T.getFullYear();case"month":return T.getMonth()+1;case"day":return T.getDate()}},V=()=>{const i=e.minDate.getFullYear(),T=e.maxDate.getFullYear();return de(i,T,"year",e.formatter,e.filter,f.value)},S=()=>{const i=_("year"),T=p(i)?e.minDate.getMonth()+1:1,Y=v(i)?e.maxDate.getMonth()+1:12;return de(T,Y,"month",e.formatter,e.filter,f.value)},P=()=>{const i=_("year"),T=_("month"),Y=p(i)&&B(T)?e.minDate.getDate():1,h=v(i)&&w(T)?e.maxDate.getDate():en(i,T);return de(Y,h,"day",e.formatter,e.filter,f.value)},M=()=>{var i;return(i=y.value)==null?void 0:i.confirm()},c=()=>t.value,r=E(()=>e.columnsType.map(i=>{switch(i){case"year":return V();case"month":return S();case"day":return P();default:return[]}}));G(t,i=>{j(i,e.modelValue)||a("update:modelValue",i)}),G(()=>e.modelValue,(i,T)=>{l.value=j(T,t.value),i=tn(i,r.value),j(i,t.value)||(t.value=i),l.value=!1},{immediate:!0});const g=(...i)=>a("change",...i),C=(...i)=>a("cancel",...i),x=(...i)=>a("confirm",...i);return J({confirm:M,getSelectedDate:c}),()=>u(Ue,re({ref:y,modelValue:t.value,"onUpdate:modelValue":i=>t.value=i,columns:r.value,onChange:g,onCancel:C,onConfirm:x},le(e,Qt)),n)}});const ln=z(on),[sn,N,te]=U("dialog"),rn=$({},vt,{title:String,theme:String,width:W,message:[String,Function],callback:Function,allowHtml:Boolean,className:nt,transition:Ee("van-dialog-bounce"),messageAlign:String,closeOnPopstate:q,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:q,closeOnClickOverlay:Boolean,keyboardEnabled:q,destroyOnClose:Boolean}),un=[...ft,"transition","closeOnPopstate","destroyOnClose"];var Ke=R({name:sn,props:rn,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:a,slots:n}){const t=O(),l=Xe({confirm:!1,cancel:!1}),y=r=>a("update:show",r),f=r=>{var g;y(!1),(g=e.callback)==null||g.call(e,r)},p=r=>()=>{e.show&&(a(r),e.beforeClose?(l[r]=!0,st(e.beforeClose,{args:[r],done(){f(r),l[r]=!1},canceled(){l[r]=!1}})):f(r))},v=p("cancel"),B=p("confirm"),w=et(r=>{var g,C;if(!e.keyboardEnabled||r.target!==((C=(g=t.value)==null?void 0:g.popupRef)==null?void 0:C.value))return;({Enter:e.showConfirmButton?B:De,Escape:e.showCancelButton?v:De})[r.key](),a("keydown",r)},["enter","esc"]),_=()=>{const r=n.title?n.title():e.title;if(r)return u("div",{class:N("header",{isolated:!e.message&&!n.default})},[r])},V=r=>{const{message:g,allowHtml:C,messageAlign:x}=e,i=N("message",{"has-title":r,[x]:x}),T=at(g)?g():g;return C&&typeof T=="string"?u("div",{class:i,innerHTML:T},null):u("div",{class:i},[T])},S=()=>{if(n.default)return u("div",{class:N("content")},[n.default()]);const{title:r,message:g,allowHtml:C}=e;if(g){const x=!!(r||n.title);return u("div",{key:C?1:0,class:N("content",{isolated:!x})},[V(x)])}},P=()=>u("div",{class:[lt,N("footer")]},[e.showCancelButton&&u(se,{size:"large",text:e.cancelButtonText||te("cancel"),class:N("cancel"),style:{color:e.cancelButtonColor},loading:l.cancel,disabled:e.cancelButtonDisabled,onClick:v},null),e.showConfirmButton&&u(se,{size:"large",text:e.confirmButtonText||te("confirm"),class:[N("confirm"),{[ot]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:l.confirm,disabled:e.confirmButtonDisabled,onClick:B},null)]),M=()=>u(xt,{class:N("footer")},{default:()=>[e.showCancelButton&&u(Te,{type:"warning",text:e.cancelButtonText||te("cancel"),class:N("cancel"),color:e.cancelButtonColor,loading:l.cancel,disabled:e.cancelButtonDisabled,onClick:v},null),e.showConfirmButton&&u(Te,{type:"danger",text:e.confirmButtonText||te("confirm"),class:N("confirm"),color:e.confirmButtonColor,loading:l.confirm,disabled:e.confirmButtonDisabled,onClick:B},null)]}),c=()=>n.footer?n.footer():e.theme==="round-button"?M():P();return()=>{const{width:r,title:g,theme:C,message:x,className:i}=e;return u(Ie,re({ref:t,role:"dialog",class:[N([C]),i],style:{width:tt(r)},tabindex:0,"aria-labelledby":g||x,onKeydown:w,"onUpdate:show":y},le(e,un)),{default:()=>[_(),S(),c()]})}}});let fe;const cn={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1,destroyOnClose:!1};let dn=$({},cn);function mn(){({instance:fe}=gt({setup(){const{state:a,toggle:n}=ht();return()=>u(Ke,re(a,{"onUpdate:show":n}),null)}}))}function qe(e){return rt?new Promise((a,n)=>{fe||mn(),fe.open($({},dn,e,{callback:t=>{(t==="confirm"?a:n)(t)}}))}):Promise.resolve(void 0)}const fn=e=>qe($({showCancelButton:!0},e));z(Ke);const vn={class:"booking-view"},gn={class:"booking-content"},hn={class:"submit-container"},bn=R({__name:"BookingView",setup(e){const a=ct(),n=bt(),t=O({device_id:null,start_date:"",end_date:"",customer_name:"",customer_phone:"",destination:"",xianyu_order_no:"",order_amount:void 0}),l=O(!1),y=O(!1),f=O(!1),p=O(!1),v=O(""),B=O(""),w=O(""),_=O(""),V=O([]),S=O([]),P=new Date(2020,0,1),M=new Date(2030,11,31);it(()=>{n.loadDevices();const h=I();V.value=[h.format("YYYY"),h.format("MM"),h.format("DD")],S.value=[h.add(7,"day").format("YYYY"),h.add(7,"day").format("MM"),h.add(7,"day").format("DD")]});const c=E(()=>n.allDevices.find(h=>h.id===t.value.device_id)),r=E(()=>n.allDevices.filter(h=>!h.is_accessory&&h.status==="online").map(h=>({text:`${h.name} (${h.model})`,value:h.id}))),g=({selectedOptions:h})=>{const o=h[0];t.value.device_id=o.value,v.value=o.text,y.value=!1},C=({selectedValues:h})=>{const o=h.join("-");if(t.value.start_date=o,B.value=I(o).format("YYYY-MM-DD"),f.value=!1,t.value.end_date&&I(t.value.end_date).isBefore(I(o))){const m=I(o).add(7,"day");t.value.end_date=m.format("YYYY-MM-DD"),w.value=m.format("YYYY-MM-DD"),S.value=[m.format("YYYY"),m.format("MM"),m.format("DD")]}},x=({selectedValues:h})=>{const o=h.join("-");if(t.value.start_date&&I(o).isBefore(I(t.value.start_date))){K({message:"结束日期不能早于开始日期",position:"top"});return}t.value.end_date=o,w.value=I(o).format("YYYY-MM-DD"),p.value=!1},i=()=>{if(!t.value.start_date||!t.value.end_date)return 0;const h=I(t.value.start_date);return I(t.value.end_date).diff(h,"day")+1},T=async()=>{if(!t.value.device_id){K({message:"请选择设备",position:"top"});return}if(!t.value.start_date||!t.value.end_date){K({message:"请选择租赁日期",position:"top"});return}if(!t.value.customer_name){K({message:"请输入客户名称",position:"top"});return}if(!t.value.customer_phone){K({message:"请输入联系电话",position:"top"});return}if(!t.value.destination){K({message:"请输入目的地",position:"top"});return}_.value&&(t.value.order_amount=parseFloat(_.value)),l.value=!0;try{const h=I(t.value.start_date).subtract(2,"day").hour(9).minute(0).format("YYYY-MM-DD HH:mm:ss"),o=I(t.value.end_date).add(2,"day").hour(18).minute(0).format("YYYY-MM-DD HH:mm:ss"),m=await Dt({device_id:t.value.device_id,ship_out_time:h,ship_in_time:o});if(m.success&&m.data.has_conflicts&&!await fn({title:"检测到冲突",message:"该设备在选定的时间段内已有租赁记录,是否继续创建?"})){l.value=!1;return}const b=await Bt(t.value);if(b.success)qe({title:"成功",message:"租赁创建成功!"}).then(()=>{n.refreshData(),a.push("/gantt")});else throw new Error(b.error||"创建租赁失败")}catch(h){K({message:h.message||"创建失败,请重试",position:"top"}),console.error("Failed to create rental:",h)}finally{l.value=!1}},Y=()=>{t.value={device_id:null,start_date:"",end_date:"",customer_name:"",customer_phone:"",destination:"",xianyu_order_no:"",order_amount:void 0},v.value="",B.value="",w.value="",_.value="",K({message:"已重置表单",position:"top"})};return(h,o)=>{const m=yt,b=_t,s=pt,d=se,k=Zt,L=Ue,H=Ie,Q=ln;return ue(),ut("div",vn,[u(m,{title:"预约档期",fixed:""}),Be("div",gn,[u(k,{onSubmit:T},{default:F(()=>[u(s,{inset:"",title:"设备信息"},{default:F(()=>[u(b,{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=D=>v.value=D),label:"选择设备",placeholder:"点击选择设备",readonly:"","right-icon":"arrow",required:"",onClick:o[1]||(o[1]=D=>y.value=!0)},null,8,["modelValue"]),t.value.device_id?(ue(),we(b,{key:0,label:"设备型号",value:c.value?.model||"-",readonly:""},null,8,["value"])):Ce("",!0)]),_:1}),u(s,{inset:"",title:"租赁日期"},{default:F(()=>[u(b,{modelValue:B.value,"onUpdate:modelValue":o[2]||(o[2]=D=>B.value=D),label:"开始日期",placeholder:"选择开始日期",readonly:"","right-icon":"calendar-o",required:"",onClick:o[3]||(o[3]=D=>f.value=!0)},null,8,["modelValue"]),u(b,{modelValue:w.value,"onUpdate:modelValue":o[4]||(o[4]=D=>w.value=D),label:"结束日期",placeholder:"选择结束日期",readonly:"","right-icon":"calendar-o",required:"",onClick:o[5]||(o[5]=D=>p.value=!0)},null,8,["modelValue"]),t.value.start_date&&t.value.end_date?(ue(),we(b,{key:0,label:"租赁天数",value:`${i()} 天`,readonly:""},null,8,["value"])):Ce("",!0)]),_:1}),u(s,{inset:"",title:"客户信息"},{default:F(()=>[u(b,{modelValue:t.value.customer_name,"onUpdate:modelValue":o[6]||(o[6]=D=>t.value.customer_name=D),label:"客户名称",placeholder:"请输入客户名称",required:"",rules:[{required:!0,message:"请输入客户名称"}]},null,8,["modelValue"]),u(b,{modelValue:t.value.customer_phone,"onUpdate:modelValue":o[7]||(o[7]=D=>t.value.customer_phone=D),label:"联系电话",placeholder:"请输入联系电话",type:"tel",required:"",rules:[{required:!0,message:"请输入联系电话"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号"}]},null,8,["modelValue"]),u(b,{modelValue:t.value.destination,"onUpdate:modelValue":o[8]||(o[8]=D=>t.value.destination=D),label:"目的地",placeholder:"请输入目的地",required:"",rules:[{required:!0,message:"请输入目的地"}]},null,8,["modelValue"])]),_:1}),u(s,{inset:"",title:"订单信息(可选)"},{default:F(()=>[u(b,{modelValue:t.value.xianyu_order_no,"onUpdate:modelValue":o[9]||(o[9]=D=>t.value.xianyu_order_no=D),label:"闲鱼订单号",placeholder:"请输入闲鱼订单号"},null,8,["modelValue"]),u(b,{modelValue:_.value,"onUpdate:modelValue":o[10]||(o[10]=D=>_.value=D),label:"订单金额",placeholder:"请输入订单金额",type:"number"},null,8,["modelValue"])]),_:1}),Be("div",hn,[u(d,{round:"",block:"",type:"primary","native-type":"submit",loading:l.value},{default:F(()=>[...o[19]||(o[19]=[ke(" 创建租赁 ",-1)])]),_:1},8,["loading"]),u(d,{round:"",block:"",plain:"",type:"default",onClick:Y},{default:F(()=>[...o[20]||(o[20]=[ke(" 重置 ",-1)])]),_:1})])]),_:1})]),u(H,{show:y.value,"onUpdate:show":o[12]||(o[12]=D=>y.value=D),position:"bottom"},{default:F(()=>[u(L,{columns:r.value,onConfirm:g,onCancel:o[11]||(o[11]=D=>y.value=!1)},null,8,["columns"])]),_:1},8,["show"]),u(H,{show:f.value,"onUpdate:show":o[15]||(o[15]=D=>f.value=D),position:"bottom"},{default:F(()=>[u(Q,{modelValue:V.value,"onUpdate:modelValue":o[13]||(o[13]=D=>V.value=D),title:"选择开始日期","min-date":ee(P),"max-date":ee(M),onConfirm:C,onCancel:o[14]||(o[14]=D=>f.value=!1)},null,8,["modelValue","min-date","max-date"])]),_:1},8,["show"]),u(H,{show:p.value,"onUpdate:show":o[18]||(o[18]=D=>p.value=D),position:"bottom"},{default:F(()=>[u(Q,{modelValue:S.value,"onUpdate:modelValue":o[16]||(o[16]=D=>S.value=D),title:"选择结束日期","min-date":ee(P),"max-date":ee(M),onConfirm:x,onCancel:o[17]||(o[17]=D=>p.value=!1)},null,8,["modelValue","min-date","max-date"])]),_:1},8,["show"])])}}}),_n=wt(bn,[["__scopeId","data-v-84cdf7ca"]]);export{_n as default};
