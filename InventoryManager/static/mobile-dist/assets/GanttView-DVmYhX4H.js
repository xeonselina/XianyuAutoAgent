import{d as L,m as O,t as rt,c as W,a as t,T as vt,H as gt,I as it,w as Z,g as pt,b as J,n as _t,r as M,u as yt,e as xt,f as wt,h as kt,i as Dt,j as Ft,p as ct,k as ut,l as tt,o as Et,q as bt,s as C,v as b,x as p,y as G,z as R,A as P,F as et,B as at,C as K,D as nt,E as k,G as lt}from"./index-C8Hbrb_-.js";import{u as dt,a as St,L as ht,b as Tt,F as Ct,f as ft,c as Bt,N as It,B as $t,P as Mt,d as D,C as Vt,e as At,s as st,_ as Gt}from"./_plugin-vue_export-helper-95OR25_x.js";const[Pt,ot]=W("tag"),Ht={size:String,mark:Boolean,show:rt,type:O("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var Rt=L({name:Pt,props:Ht,emits:["close"],setup(l,{slots:s,emit:c}){const m=n=>{n.stopPropagation(),c("close",n)},x=()=>l.plain?{color:l.textColor||l.color,borderColor:l.color}:{color:l.textColor,background:l.color},r=()=>{var n;const{type:o,mark:u,plain:S,round:v,size:y,closeable:_}=l,F={mark:u,plain:S,round:v};y&&(F[y]=y);const T=_&&t(it,{name:"cross",class:[ot("close"),gt],onClick:m},null);return t("span",{style:x(),class:ot([F,o])},[(n=s.default)==null?void 0:n.call(s),T])};return()=>t(vt,{name:l.closeable?"van-fade":void 0},{default:()=>[l.show?r():null]})}});const zt=Z(Rt),[Nt,j]=W("empty"),Lt={image:O("default"),imageSize:[Number,String,Array],description:String};var Ut=L({name:Nt,props:Lt,setup(l,{slots:s}){const c=()=>{const d=s.description?s.description():l.description;if(d)return t("p",{class:j("description")},[d])},m=()=>{if(s.default)return t("div",{class:j("bottom")},[s.default()])},x=dt(),r=d=>`${x}-${d}`,n=d=>`url(#${r(d)})`,o=(d,w,i)=>t("stop",{"stop-color":d,offset:`${w}%`,"stop-opacity":i},null),u=(d,w)=>[o(d,0),o(w,100)],S=d=>[t("defs",null,[t("radialGradient",{id:r(d),cx:"50%",cy:"54%",fx:"50%",fy:"54%",r:"297%",gradientTransform:"matrix(-.16 0 0 -.33 .58 .72)","data-allow-mismatch":"attribute"},[o("#EBEDF0",0),o("#F2F3F5",100,.3)])]),t("ellipse",{fill:n(d),opacity:".8",cx:"80",cy:"140",rx:"46",ry:"8","data-allow-mismatch":"attribute"},null)],v=()=>[t("defs",null,[t("linearGradient",{id:r("a"),x1:"64%",y1:"100%",x2:"64%","data-allow-mismatch":"attribute"},[o("#FFF",0,.5),o("#F2F3F5",100)])]),t("g",{opacity:".8","data-allow-mismatch":"children"},[t("path",{d:"M36 131V53H16v20H2v58h34z",fill:n("a")},null),t("path",{d:"M123 15h22v14h9v77h-31V15z",fill:n("a")},null)])],y=()=>[t("defs",null,[t("linearGradient",{id:r("b"),x1:"64%",y1:"97%",x2:"64%",y2:"0%","data-allow-mismatch":"attribute"},[o("#F2F3F5",0,.3),o("#F2F3F5",100)])]),t("g",{opacity:".8","data-allow-mismatch":"children"},[t("path",{d:"M87 6c3 0 7 3 8 6a8 8 0 1 1-1 16H80a7 7 0 0 1-8-6c0-4 3-7 6-7 0-5 4-9 9-9Z",fill:n("b")},null),t("path",{d:"M19 23c2 0 3 1 4 3 2 0 4 2 4 4a4 4 0 0 1-4 3v1h-7v-1l-1 1c-2 0-3-2-3-4 0-1 1-3 3-3 0-2 2-4 4-4Z",fill:n("b")},null)])],_=()=>t("svg",{viewBox:"0 0 160 160"},[t("defs",{"data-allow-mismatch":"children"},[t("linearGradient",{id:r(1),x1:"64%",y1:"100%",x2:"64%"},[o("#FFF",0,.5),o("#F2F3F5",100)]),t("linearGradient",{id:r(2),x1:"50%",x2:"50%",y2:"84%"},[o("#EBEDF0",0),o("#DCDEE0",100,0)]),t("linearGradient",{id:r(3),x1:"100%",x2:"100%",y2:"100%"},[u("#EAEDF0","#DCDEE0")]),t("radialGradient",{id:r(4),cx:"50%",cy:"0%",fx:"50%",fy:"0%",r:"100%",gradientTransform:"matrix(0 1 -.54 0 .5 -.5)"},[o("#EBEDF0",0),o("#FFF",100,0)])]),t("g",{fill:"none"},[v(),t("path",{fill:n(4),d:"M0 139h160v21H0z","data-allow-mismatch":"attribute"},null),t("path",{d:"M80 54a7 7 0 0 1 3 13v27l-2 2h-2a2 2 0 0 1-2-2V67a7 7 0 0 1 3-13z",fill:n(2),"data-allow-mismatch":"attribute"},null),t("g",{opacity:".6","stroke-linecap":"round","stroke-width":"7","data-allow-mismatch":"children"},[t("path",{d:"M64 47a19 19 0 0 0-5 13c0 5 2 10 5 13",stroke:n(3)},null),t("path",{d:"M53 36a34 34 0 0 0 0 48",stroke:n(3)},null),t("path",{d:"M95 73a19 19 0 0 0 6-13c0-5-2-9-6-13",stroke:n(3)},null),t("path",{d:"M106 84a34 34 0 0 0 0-48",stroke:n(3)},null)]),t("g",{transform:"translate(31 105)"},[t("rect",{fill:"#EBEDF0",width:"98",height:"34",rx:"2"},null),t("rect",{fill:"#FFF",x:"9",y:"8",width:"80",height:"18",rx:"1.1"},null),t("rect",{fill:"#EBEDF0",x:"15",y:"12",width:"18",height:"6",rx:"1.1"},null)])])]),F=()=>t("svg",{viewBox:"0 0 160 160"},[t("defs",{"data-allow-mismatch":"children"},[t("linearGradient",{x1:"50%",x2:"50%",y2:"100%",id:r(5)},[u("#F2F3F5","#DCDEE0")]),t("linearGradient",{x1:"95%",y1:"48%",x2:"5.5%",y2:"51%",id:r(6)},[u("#EAEDF1","#DCDEE0")]),t("linearGradient",{y1:"45%",x2:"100%",y2:"54%",id:r(7)},[u("#EAEDF1","#DCDEE0")])]),v(),y(),t("g",{transform:"translate(36 50)",fill:"none"},[t("g",{transform:"translate(8)"},[t("rect",{fill:"#EBEDF0",opacity:".6",x:"38",y:"13",width:"36",height:"53",rx:"2"},null),t("rect",{fill:n(5),width:"64",height:"66",rx:"2","data-allow-mismatch":"attribute"},null),t("rect",{fill:"#FFF",x:"6",y:"6",width:"52",height:"55",rx:"1"},null),t("g",{transform:"translate(15 17)",fill:n(6),"data-allow-mismatch":"attribute"},[t("rect",{width:"34",height:"6",rx:"1"},null),t("path",{d:"M0 14h34v6H0z"},null),t("rect",{y:"28",width:"34",height:"6",rx:"1"},null)])]),t("rect",{fill:n(7),y:"61",width:"88",height:"28",rx:"1","data-allow-mismatch":"attribute"},null),t("rect",{fill:"#F7F8FA",x:"29",y:"72",width:"30",height:"6",rx:"1"},null)])]),T=()=>t("svg",{viewBox:"0 0 160 160"},[t("defs",null,[t("linearGradient",{x1:"50%",x2:"50%",y2:"100%",id:r(8),"data-allow-mismatch":"attribute"},[u("#EAEDF1","#DCDEE0")])]),v(),y(),S("c"),t("path",{d:"m59 60 21 21 21-21h3l9 9v3L92 93l21 21v3l-9 9h-3l-21-21-21 21h-3l-9-9v-3l21-21-21-21v-3l9-9h3Z",fill:n(8),"data-allow-mismatch":"attribute"},null)]),V=()=>t("svg",{viewBox:"0 0 160 160"},[t("defs",{"data-allow-mismatch":"children"},[t("linearGradient",{x1:"50%",y1:"100%",x2:"50%",id:r(9)},[u("#EEE","#D8D8D8")]),t("linearGradient",{x1:"100%",y1:"50%",y2:"50%",id:r(10)},[u("#F2F3F5","#DCDEE0")]),t("linearGradient",{x1:"50%",x2:"50%",y2:"100%",id:r(11)},[u("#F2F3F5","#DCDEE0")]),t("linearGradient",{x1:"50%",x2:"50%",y2:"100%",id:r(12)},[u("#FFF","#F7F8FA")])]),v(),y(),S("d"),t("g",{transform:"rotate(-45 113 -4)",fill:"none","data-allow-mismatch":"children"},[t("rect",{fill:n(9),x:"24",y:"52.8",width:"5.8",height:"19",rx:"1"},null),t("rect",{fill:n(10),x:"22.1",y:"67.3",width:"9.9",height:"28",rx:"1"},null),t("circle",{stroke:n(11),"stroke-width":"8",cx:"27",cy:"27",r:"27"},null),t("circle",{fill:n(12),cx:"27",cy:"27",r:"16"},null),t("path",{d:"M37 7c-8 0-15 5-16 12",stroke:n(11),"stroke-width":"3",opacity:".5","stroke-linecap":"round",transform:"rotate(45 29 13)"},null)])]),I=()=>{var d;if(s.image)return s.image();const w={error:T,search:V,network:_,default:F};return((d=w[l.image])==null?void 0:d.call(w))||t("img",{src:l.image},null)};return()=>t("div",{class:j()},[t("div",{class:j("image"),style:pt(l.imageSize)},[I()]),c(),m()])}});const Yt=Z(Ut),[Kt,z,jt]=W("pull-refresh"),mt=50,Ot=["pulling","loosing","success"],Wt={disabled:Boolean,modelValue:Boolean,headHeight:J(mt),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:_t,successDuration:J(500),animationDuration:J(300)};var Zt=L({name:Kt,props:Wt,emits:["change","refresh","update:modelValue"],setup(l,{emit:s,slots:c}){let m;const x=M(),r=M(),n=yt(x),o=xt({status:"normal",distance:0,duration:0}),u=St(),S=()=>{if(l.headHeight!==mt)return{height:`${l.headHeight}px`}},v=()=>o.status!=="loading"&&o.status!=="success"&&!l.disabled,y=e=>{const a=+(l.pullDistance||l.headHeight);return e>a&&(e<a*2?e=a+(e-a)/2:e=a*1.5+(e-a*2)/4),Math.round(e)},_=(e,a)=>{const f=+(l.pullDistance||l.headHeight);o.distance=e,a?o.status="loading":e===0?o.status="normal":e<f?o.status="pulling":o.status="loosing",s("change",{status:o.status,distance:e})},F=()=>{const{status:e}=o;return e==="normal"?"":l[`${e}Text`]||jt(e)},T=()=>{const{status:e,distance:a}=o;if(c[e])return c[e]({distance:a});const f=[];return Ot.includes(e)&&f.push(t("div",{class:z("text")},[F()])),e==="loading"&&f.push(t(ht,{class:z("loading")},{default:F})),f},V=()=>{o.status="success",setTimeout(()=>{_(0)},+l.successDuration)},I=e=>{m=Ft(n.value)===0,m&&(o.duration=0,u.start(e))},d=e=>{v()&&I(e)},w=e=>{if(v()){m||I(e);const{deltaY:a}=u;u.move(e),m&&a.value>=0&&u.isVertical()&&(ct(e),_(y(a.value)))}},i=()=>{m&&u.deltaY.value&&v()&&(o.duration=+l.animationDuration,o.status==="loosing"?(_(+l.headHeight,!0),s("update:modelValue",!0),Dt(()=>s("refresh"))):_(0))};return wt(()=>l.modelValue,e=>{o.duration=+l.animationDuration,e?_(+l.headHeight,!0):c.success||l.successText?V():_(0,!1)}),kt("touchmove",w,{target:r}),()=>{var e;const a={transitionDuration:`${o.duration}ms`,transform:o.distance?`translate3d(0,${o.distance}px, 0)`:""};return t("div",{ref:x,class:z()},[t("div",{ref:r,class:z("track"),style:a,onTouchstartPassive:d,onTouchend:i,onTouchcancel:i},[t("div",{class:z("head"),style:S()},[T()]),(e=c.default)==null?void 0:e.call(c)])])}}});const qt=Z(Zt),[Xt,N,Jt]=W("search"),Qt=ut({},ft,{label:String,shape:O("square"),leftIcon:O("search"),clearable:rt,actionText:String,background:String,showAction:Boolean});var te=L({name:Xt,props:Qt,emits:["blur","focus","clear","search","cancel","clickInput","clickLeftIcon","clickRightIcon","update:modelValue"],setup(l,{emit:s,slots:c,attrs:m}){const x=dt(),r=M(),n=()=>{c.action||(s("update:modelValue",""),s("cancel"))},o=a=>{a.keyCode===13&&(ct(a),s("search",l.modelValue))},u=()=>l.id||`${x}-input`,S=()=>{if(c.label||l.label)return t("label",{class:N("label"),for:u(),"data-allow-mismatch":"attribute"},[c.label?c.label():l.label])},v=()=>{if(l.showAction){const a=l.actionText||Jt("cancel");return t("div",{class:N("action"),role:"button",tabindex:0,onClick:n},[c.action?c.action():a])}},y=()=>{var a;return(a=r.value)==null?void 0:a.blur()},_=()=>{var a;return(a=r.value)==null?void 0:a.focus()},F=a=>s("blur",a),T=a=>s("focus",a),V=a=>s("clear",a),I=a=>s("clickInput",a),d=a=>s("clickLeftIcon",a),w=a=>s("clickRightIcon",a),i=Object.keys(ft),e=()=>{const a=ut({},m,tt(l,i),{id:u()}),f=B=>s("update:modelValue",B);return t(Ct,Et({ref:r,type:"search",class:N("field",{"with-message":a.errorMessage}),border:!1,labelAlign:"left",onBlur:F,onFocus:T,onClear:V,onKeypress:o,onClickInput:I,onClickLeftIcon:d,onClickRightIcon:w,"onUpdate:modelValue":f},a),tt(c,["left-icon","right-icon"]))};return Tt({focus:_,blur:y}),()=>{var a;return t("div",{class:N({"show-action":l.showAction}),style:{background:l.background}},[(a=c.left)==null?void 0:a.call(c),t("div",{class:N("content",l.shape)},[S(),e()]),v()])}}});const ee=Z(te),ae={class:"gantt-view"},ne={class:"date-picker"},le={class:"date-range"},se={key:0,class:"loading-container"},oe={key:1,class:"empty-container"},re={key:2,class:"device-list"},ie={class:"device-title"},ce={class:"device-name"},ue={class:"device-info"},de={key:0},he={class:"timeline-container"},fe={class:"timeline"},me=["onClick"],ve={class:"rental-label"},ge={key:0,class:"rental-detail"},pe=L({__name:"GanttView",setup(l){const s=Bt(),c=M(!1),m=M(!1),x=M(!1),r=M(""),n=M(null);bt(()=>{s.loadGanttData()});const o=async()=>{try{await s.refreshData(),st({message:"刷新成功",position:"top"})}catch{st({message:"刷新失败",position:"top"})}finally{c.value=!1}},u=i=>{i<0?s.navigatePreviousWeek():s.navigateNextWeek()},S=()=>{s.goToToday()},v=()=>{s.setSearchKeyword(r.value),m.value=!1},y=()=>{r.value="",s.clearSearch()},_=i=>{n.value=i,x.value=!0},F=(i,e)=>`${D(i).format("M月D日")} - ${D(e).format("M月D日")}`,T=i=>i?D(i).format("YYYY-MM-DD HH:mm"):"-",V=i=>({not_shipped:"未发货",scheduled_for_shipping:"待发货",shipped:"已发货",returned:"已归还",completed:"已完成",cancelled:"已取消"})[i]||i,I=i=>({not_shipped:"default",scheduled_for_shipping:"warning",shipped:"primary",returned:"success",completed:"success",cancelled:"danger"})[i]||"default",d=()=>{const i=D(s.currentStartDate),e=D(s.currentEndDate),a=D();if(a.isBefore(i)||a.isAfter(e))return-10;const f=e.diff(i,"day");return a.diff(i,"day")/f*100},w=i=>{const e=D(s.currentStartDate),a=D(s.currentEndDate),f=a.diff(e,"day");if(f===0)return[];const B=[];return i.rentals.filter(E=>{const A=D(E.start_date);return D(E.end_date).isAfter(e)&&A.isBefore(a)}).forEach(E=>{const A=D(E.start_date),g=D(E.end_date),U=A.isBefore(e)?e:A,q=g.isAfter(a)?a:g,Y=U.diff(e,"day"),X=q.diff(U,"day")+1,h=Y/f*100,$=X/f*100;let H="#1989fa";E.status==="completed"?H="#07c160":E.status==="cancelled"?H="#ee0a24":E.status==="shipped"&&(H="#ff976a"),B.push({rental:E,left:h,width:$,color:H})}),B};return(i,e)=>{const a=it,f=It,B=$t,Q=ht,E=Yt,A=zt,g=At,U=qt,q=ee,Y=Mt,X=Vt;return k(),C("div",ae,[t(f,{title:"设备档期",fixed:""},{right:p(()=>[t(a,{name:"search",onClick:e[0]||(e[0]=h=>m.value=!0)})]),_:1}),b("div",ne,[t(B,{size:"small",onClick:e[1]||(e[1]=h=>u(-1))},{default:p(()=>[t(a,{name:"arrow-left"}),e[7]||(e[7]=P(" 上周 ",-1))]),_:1}),t(B,{size:"small",type:"primary",onClick:S},{default:p(()=>[...e[8]||(e[8]=[P(" 今天 ",-1)])]),_:1}),t(B,{size:"small",onClick:e[2]||(e[2]=h=>u(1))},{default:p(()=>[e[9]||(e[9]=P(" 下周 ",-1)),t(a,{name:"arrow"})]),_:1})]),b("div",le,G(F(R(s).currentStartDate,R(s).currentEndDate)),1),t(U,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=h=>c.value=h),onRefresh:o},{default:p(()=>[R(s).loading&&!c.value?(k(),C("div",se,[t(Q,{type:"spinner",size:"24px"},{default:p(()=>[...e[10]||(e[10]=[P("加载中...",-1)])]),_:1})])):R(s).filteredDevices.length===0?(k(),C("div",oe,[t(E,{description:"暂无设备数据"})])):(k(),C("div",re,[(k(!0),C(et,null,at(R(s).filteredDevices,h=>(k(),C("div",{key:h.id,class:"device-row"},[t(g,null,{title:p(()=>[b("div",ie,[b("span",ce,G(h.name),1),t(A,{type:h.status==="online"?"success":"danger"},{default:p(()=>[P(G(h.status==="online"?"在线":"离线"),1)]),_:2},1032,["type"])])]),label:p(()=>[b("div",ue,[b("span",null,G(h.model),1),h.serial_number?(k(),C("span",de," · "+G(h.serial_number),1)):K("",!0)]),b("div",he,[b("div",fe,[(k(!0),C(et,null,at(w(h),$=>(k(),C("div",{key:$.rental.id,class:"rental-block",style:lt({left:`${$.left}%`,width:`${$.width}%`,background:$.color}),onClick:H=>_($.rental)},[b("span",ve,G($.rental.customer_name),1)],12,me))),128)),b("div",{class:"today-marker",style:lt({left:`${d()}%`})},null,4)])])]),_:2},1024)]))),128))]))]),_:1},8,["modelValue"]),t(Y,{show:m.value,"onUpdate:show":e[5]||(e[5]=h=>m.value=h),position:"top",style:{height:"120px"}},{default:p(()=>[t(q,{modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=h=>r.value=h),placeholder:"搜索设备或客户名称","show-action":"",onSearch:v,onClear:y},{action:p(()=>[b("div",{onClick:v},"搜索")]),_:1},8,["modelValue"])]),_:1},8,["show"]),t(Y,{show:x.value,"onUpdate:show":e[6]||(e[6]=h=>x.value=h),position:"bottom",style:{height:"60%"}},{default:p(()=>[n.value?(k(),C("div",ge,[t(f,{title:"租赁详情"}),t(X,null,{default:p(()=>[t(g,{title:"客户名称",value:n.value.customer_name},null,8,["value"]),t(g,{title:"联系电话",value:n.value.customer_phone||"-"},null,8,["value"]),t(g,{title:"目的地",value:n.value.destination||"-"},null,8,["value"]),t(g,{title:"开始日期",value:n.value.start_date},null,8,["value"]),t(g,{title:"结束日期",value:n.value.end_date},null,8,["value"]),t(g,{title:"发出时间",value:T(n.value.ship_out_time)},null,8,["value"]),t(g,{title:"归还时间",value:T(n.value.ship_in_time)},null,8,["value"]),t(g,{title:"状态"},{value:p(()=>[t(A,{type:I(n.value.status)},{default:p(()=>[P(G(V(n.value.status)),1)]),_:1},8,["type"])]),_:1}),n.value.xianyu_order_no?(k(),nt(g,{key:0,title:"闲鱼订单号",value:n.value.xianyu_order_no},null,8,["value"])):K("",!0),n.value.order_amount?(k(),nt(g,{key:1,title:"订单金额",value:`¥${n.value.order_amount}`},null,8,["value"])):K("",!0)]),_:1})])):K("",!0)]),_:1},8,["show"])])}}}),xe=Gt(pe,[["__scopeId","data-v-23c5c459"]]);export{xe as default};
