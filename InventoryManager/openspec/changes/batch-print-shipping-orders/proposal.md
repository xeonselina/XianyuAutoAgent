# 批量打印发货单

## Why

当前系统在发货前需要打印发货单，但流程效率低下：
1. 必须在甘特图中逐条打开租赁记录
2. 点击"发货单"按钮渲染 HTML 页面
3. 使用 Chrome 的打印功能逐个打印

一天需要发多个货时，这个重复性操作消耗大量时间。批量打印功能可以通过一次输入发货日期范围，自动生成该范围内所有待发货订单的打印任务，显著提升发货效率。

## What Changes

### 用户体验改进
- 在甘特图顶部添加"批量打印发货单"按钮
- 点击后弹出日期范围选择对话框
- 系统自动查询发货日期在范围内的所有待发货租赁记录
- 生成批量打印任务，一次性打印所有发货单

### 技术实现
- 新增批量查询 API：根据发货日期范围查询租赁记录
- 新增批量打印视图：在单个页面中渲染多个发货单
- 利用 CSS 打印媒体查询实现分页打印
- 保持现有单个发货单打印逻辑不变

## Impact

### 用户影响
- **效率提升**：日发货 10 单时，操作时间从约 10 分钟降至 1 分钟内
- **错误减少**：避免手动逐条操作可能遗漏的订单
- **体验优化**：一键完成批量操作，减少重复点击

### 系统影响
- **性能**：批量打印需同时加载多条记录，但打印操作为低频场景，影响可控
- **打印机**：Mac 通过无线连接网络打印机，Chrome 打印对话框支持分页预览
- **兼容性**：新增功能不影响现有单条打印流程

### 风险评估
- **打印顺序**：需确保打印顺序与发货时间顺序一致
- **数据量**：高峰期可能一次打印 20+ 单，需测试浏览器和打印机承载能力
- **错误处理**：部分记录数据不完整时，应跳过并提示用户

## Alternatives Considered

### 方案 1：导出 PDF 批量打印
- **优点**：可离线保存，打印更稳定
- **缺点**：需额外生成 PDF 步骤，增加服务器负担
- **结论**：未选择，优先保持当前 HTML 打印方式的简洁性

### 方案 2：后台任务队列打印
- **优点**：可处理大批量打印任务
- **缺点**：需要额外的任务队列系统，过度设计
- **结论**：未选择，日常发货量不需要如此复杂的架构

## Dependencies

- 依赖现有 `ShippingOrderView.vue` 的发货单模板设计
- 依赖 Rental 模型的 `ship_out_time` 字段进行日期范围查询
- Chrome 浏览器的打印 API（`window.print()`）
- Mac 系统与网络打印机的无线连接稳定性

## Rollout Plan

### Phase 1: 核心功能（MVP）
1. 实现日期范围查询 API
2. 创建批量打印对话框组件
3. 实现批量打印视图（多发货单渲染）
4. 添加打印分页样式

### Phase 2: 优化增强
1. 添加打印预览功能
2. 支持手动选择/排除特定订单
3. 打印前验证数据完整性
4. 打印历史记录

### 测试策略
- 单元测试：日期范围查询逻辑
- 集成测试：批量打印 API
- 手动测试：实际打印 1/5/10/20 单的效果
- 边界测试：空数据、超大数据量处理
