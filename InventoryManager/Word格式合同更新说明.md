# Word格式合同更新说明

## 更新概述

已严格按照`docs/设备租赁合同模板.docx`的格式重新设计了租赁合同模板，确保生成的合同与原Word文档完全一致。

## 主要更新内容

### 1. 合同标题
- **更新前**: `设备租赁合同`
- **更新后**: `设备租赁合同（设备名称）` - 严格按照Word模板格式

### 2. 合同前言
- 添加了完整的法律依据前言
- 内容：根据《中华人民共和国民法典》及相关法律规定，经过双方友好协商...

### 3. 甲乙双方信息表格
```
| 出租方（甲方）：            | 承租方（乙方）：           |
|---------------------------|---------------------------|
| 闲鱼ID：光影租界           | 闲鱼ID：{{customer_name}} |
| 真实姓名：张孝姝           | 真实姓名：{{OCR识别姓名}}  |
| 身份证号：500101...        | 身份证号：{{OCR识别号码}}  |
| 联系方式：13510224947      | 联系方式：{{customer_phone}} |
```

### 4. 租赁设备清单表格
严格按照Word模板，包含以下固定行：
- 主设备（动态填入设备名称和序列号）
- 增距镜（1支，镜头架、前后镜头盖）
- 充电线、充电头（1套）
- （其他配件）（无）

### 5. 租赁期限表格
```
| 收货日：{{ship_out_date}}           | 租赁起止日期：{{start_date}}至{{end_date}} |
| 归还日：{{ship_in_date}}            | 总计：{{rental_days}}天                    |
```

### 6. 押金表格
```
| 项目 | 金额            | 支付方式      | 退还条件                    |
| 押金 | ¥{{deposit}}元  | 闲鱼担保交易  | 验收设备无损归还后，24小时内退还 |
```

### 7. 双方权利义务
**甲方责任：**
1. 确保设备功能正常、配件齐全
2. 提供基础操作指导（如需）
3. 确认收到租金及押金后，确保乙方在起租日前一天收到设备，并及时发货

**乙方责任：**
1. 按操作规范使用设备，禁止私自改装/拆卸
2. 承担租赁期间设备保管责任
3. 归还前清理设备（镜头无指纹、机身无污渍）
4. 使用原装充电器，避免电池损坏

### 8. 设备损坏赔偿表格
```
| 情形                           | 赔偿责任                           |
| 自然使用磨损                   | 甲方承担                           |
| 激光损坏                       | 甲方承担                           |
| 人为损坏/进水/摔碰导致异常     | 乙方按维修发票金额全额赔偿，及误工费400元 |
| 设备丢失                       | 乙方按设备设备总价值赔偿           |
```

### 9. 归还验收条款
1. 乙方需在归还日12:00前寄出设备（保留快递凭证）
2. 甲方收到后24小时内完成检测，并视频记录开箱过程
3. 如有争议，双方可共同指定第三方检测机构鉴定（费用由责任方承担）

### 10. 违约条款
1. 乙方逾期归还：每超1天支付50元/天的租金，必须提前24小时与甲方确认是否有档期，否则需按100元/天补齐租金
2. 甲方未按约定退还押金：每逾期1天按押金10%支付违约金

### 11. 争议解决
因本合同产生的纠纷，双方应协商解决；协商不成时，可向甲方所在地人民法院提起诉讼。

### 12. 其他约定
1. 本合同与闲鱼平台订单互为补充，冲突时以本合同为准
2. 设备检测标准参考《摄影器材通用验机规范》
3. 本合同自双方签字盖章之日起生效

## 技术实现

### 数据变量映射
```python
# Word模板占位符 → 系统变量
{{customer_name}}     → rental.customer_name
{{身份证上姓名}}      → OCR识别结果
{{身份证号}}          → OCR识别结果
{{设备名}}           → device.name
{{设备序列号}}       → device.serial_number
{{rental.start_date}} → rental.start_date
{{rental.end_date}}   → rental.end_date
```

### 样式优化
- 表格边框和样式与Word文档一致
- 字体大小和行间距匹配原文档
- 打印格式优化，适合A4纸张

## 测试验证

通过`test_contract_format.py`进行了全面测试，验证项目包括：

✅ **合同结构完整性**
- 合同标题格式
- 甲乙双方信息表格
- 设备清单表格
- 租赁期限表格
- 押金表格
- 赔偿责任表格

✅ **内容准确性**
- 所有Word模板中的关键条款
- 法律依据引用
- 具体金额和时间规定
- 闲鱼平台相关条款

✅ **数据动态填充**
- 租赁信息自动填入
- 设备信息自动填入
- OCR识别信息填入
- 日期和金额计算

## 使用方法

1. **访问合同页面**：在甘特图中点击租赁时段弹出层的"租赁合同"按钮
2. **上传身份证**：上传身份证照片进行OCR识别
3. **填入信息**：点击"填入合同"将身份证信息填入合同
4. **检查内容**：确认所有信息正确无误
5. **打印合同**：点击"打印合同"按钮

## 文件变更清单

1. `templates/rental_contract.html` - 重写合同模板，严格按照Word格式
2. `app/routes/web.py` - 更新数据准备函数，添加设备价值等字段
3. `requirements.txt` - 添加python-docx和beautifulsoup4依赖
4. `test_contract_format.py` - 新增格式验证测试
5. `Word格式合同更新说明.md` - 本说明文档

## 后续优化建议

1. **动态配件列表**：根据不同设备类型动态生成配件清单
2. **甲方信息配置**：将甲方信息（光影租界）改为可配置
3. **合同模板多样化**：支持不同类型设备的合同模板
4. **电子签名**：集成电子签名功能
5. **合同归档**：自动保存生成的合同为PDF文件
