# 模块重构说明

## 概述

原来的 `web.py` 文件包含了超过1000行代码，包含了前端页面路由、各种API端点、业务逻辑等，导致代码难以维护。为了提高代码的可维护性和可读性，我们将其重构为多个小模块。

## 重构后的模块结构

### 1. `web_pages.py` - 前端页面路由模块
- **功能**: 负责所有前端页面的渲染
- **包含路由**:
  - `/` - 主页（甘特图界面）
  - `/gantt` - 甘特图页面
  - `/shipping-order/<rental_id>` - 出货单页面
  - `/rental-contract/<rental_id>` - 租赁合同页面
  - `/devices` - 设备管理页面
  - `/rentals` - 租赁管理页面

### 2. `gantt_api.py` - 甘特图相关API模块
- **功能**: 处理甘特图相关的数据查询和操作
- **包含端点**:
  - `GET /api/gantt/data` - 获取甘特图数据
  - `POST /api/rentals/find-slot` - 查找可用的租赁时间段

### 3. `device_api.py` - 设备相关API模块
- **功能**: 处理设备相关的CRUD操作
- **包含端点**:
  - `GET /api/devices` - 获取设备列表
  - `GET /api/devices/<device_id>` - 获取单个设备信息
  - `POST /api/devices` - 创建设备
  - `PUT /api/devices/<device_id>` - 更新设备信息
  - `DELETE /api/devices/<device_id>` - 删除设备

### 4. `rental_api.py` - 租赁相关API模块
- **功能**: 处理租赁记录相关的CRUD操作
- **包含端点**:
  - `GET /api/rentals` - 获取租赁记录列表
  - `GET /api/rentals/<rental_id>` - 获取单个租赁记录
  - `POST /api/rentals` - 创建租赁记录
  - `PUT /api/rentals/<rental_id>` - 更新租赁记录
  - `DELETE /api/rentals/<rental_id>` - 删除租赁记录
  - `GET /web/rentals/<rental_id>` - Web界面获取租赁记录
  - `PUT /web/rentals/<rental_id>` - Web界面更新租赁记录
  - `DELETE /web/rentals/<rental_id>` - Web界面删除租赁记录

### 5. `inventory_api.py` - 库存相关API模块
- **功能**: 处理库存查询相关的操作
- **包含端点**:
  - `GET /api/inventory/available` - 查询可用库存

### 6. `ocr_api.py` - OCR相关API模块
- **功能**: 处理OCR识别相关的操作
- **包含端点**:
  - `POST /api/ocr/id-card` - 身份证OCR识别

### 7. `web.py` - 主模块
- **功能**: 整合所有子模块，注册蓝图
- **包含**: 健康检查端点

## 重构优势

1. **代码可读性**: 每个模块职责单一，代码更容易理解
2. **维护性**: 修改某个功能时，只需要关注对应的模块
3. **可扩展性**: 新增功能时，可以创建新的模块或扩展现有模块
4. **团队协作**: 不同开发者可以并行开发不同模块
5. **测试友好**: 每个模块可以独立进行单元测试

## 使用方法

重构后的模块会自动被主模块 `web.py` 导入和注册，无需修改现有的应用配置。所有的路由和功能保持不变，只是代码结构更加清晰。

## 注意事项

1. 确保所有子模块都正确导入了必要的依赖
2. 子模块的蓝图名称不能冲突
3. 在添加新功能时，优先考虑扩展现有模块，而不是创建新模块
4. 保持模块间的低耦合，避免循环导入

## 文件大小对比

- **重构前**: `web.py` - 1134行
- **重构后**: 
  - `web_pages.py` - 约120行
  - `gantt_api.py` - 约200行
  - `device_api.py` - 约180行
  - `rental_api.py` - 约350行
  - `inventory_api.py` - 约80行
  - `ocr_api.py` - 约70行
  - `web.py` - 约30行

每个模块的代码量都在合理范围内，便于维护和理解。
